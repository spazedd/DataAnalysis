<body>
<header>
  <h1>Promptly Resumed</h1>
  <p class="lead">Reason with logic. Browse fresh research. (Optional) Draft research-style briefs.</p>
</header>

<div class="card">
  <div class="tabs">
    <div class="tab active" data-view="logic">Logic Engine</div>
    <div class="tab" data-view="digest">Daily Research</div>
    <div class="tab" data-view="writer" id="writerTab" style="display:none">Research Writer</div>
  </div>

  <!-- LOGIC ENGINE -->
  <div class="view active" id="logic">
    <label>Your claim</label>
    <textarea id="claim" placeholder="e.g., If X then Y..."></textarea>
    <button id="runLogic">Analyze</button>
    <div class="grid" id="logicResults" style="display:none;margin-top:12px">
      <div class="panel"><h3>Logical Defense</h3><pre id="defense"></pre></div>
      <div class="panel"><h3>Logical Challenge</h3><pre id="challenge"></pre></div>
      <div class="panel" style="grid-column:1 / -1">
        <h3>Assessment</h3><pre id="assessment"></pre>
        <h3>Logical Map</h3><pre id="lmap"></pre>
      </div>
    </div>
  </div>

  <!-- DAILY DIGEST -->
  <div class="view" id="digest">
    <p class="lead">Top items from arXiv / PubMed / Crossref & selected feeds.</p>
    <button id="loadDigest">Load Today’s Digest</button>
    <ul id="digestList" style="margin-top:12px"></ul>
  </div>

  <!-- OPTIONAL: xAI RESEARCH WRITER -->
  <div class="view" id="writer">
    <label>Topic / Question</label>
    <textarea id="topic" placeholder="e.g., What’s the evidence that X reduces Y?"></textarea>
    <div style="display:flex;gap:8px;margin-top:8px">
      <select id="tone">
        <option value="neutral analyst">Neutral analyst</option>
        <option value="policy brief">Policy brief</option>
        <option value="contrarian">Contrarian</option>
      </select>
      <select id="audience">
        <option value="general">General</option>
        <option value="technical">Technical</option>
        <option value="policy makers">Policy makers</option>
      </select>
    </div>
    <button id="runWriter" style="margin-top:10px">Draft Research Brief</button>
    <div class="panel" style="margin-top:12px;display:none" id="writerOut">
      <h3>Draft</h3>
      <pre id="writerText"></pre>
    </div>
  </div>
</div>

<footer>© Promptly Resumed</footer>

<script>
// tabs
document.querySelectorAll('.tab').forEach(t=>{
  t.onclick=()=>{document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
                 document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
                 t.classList.add('active'); document.getElementById(t.dataset.view).classList.add('active');}
});
// hide/show Writer tab by feature flag
if (window.HAS_XAI) document.getElementById('writerTab').style.display='inline-block';

// Logic Engine
const API_LOGIC = "/analyze";
document.getElementById('runLogic').onclick = async ()=>{
  const claim = document.getElementById('claim').value.trim();
  if(!claim) return;
  const r = await fetch(API_LOGIC,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({claim})});
  const d = await r.json();
  document.getElementById('defense').textContent = (d.logical_defense||[]).join("\n");
  document.getElementById('challenge').textContent = (d.logical_challenge||[]).join("\n");
  document.getElementById('assessment').textContent = d.assessment||"";
  document.getElementById('lmap').textContent = JSON.stringify(d.logical_map,null,2);
  document.getElementById('logicResults').style.display = "grid";
};

// Daily Digest
document.getElementById('loadDigest').onclick = async ()=>{
  const today = new Date().toISOString().slice(0,10);
  const url = `/data/digest/${today}.json`;
  const list = document.getElementById('digestList');
  try{
    const r = await fetch(url);
    const j = await r.json();
    list.innerHTML = j.items.map((e,i)=>`
      <li style="margin:10px 0">
        <strong>${i+1}. ${e.title}</strong><br/>
        <em>${e.source}</em> — Score ${e.score} — <a href="${e.url}" target="_blank">Link</a>
        ${e.abstract ? `<div style="opacity:.85;margin-top:4px">${e.abstract.slice(0,300)}${e.abstract.length>300?'…':''}</div>`:''}
      </li>`).join("");
  }catch(e){ list.innerHTML = "<li>Today’s digest not available yet.</li>"; }
};

// OPTIONAL Research Writer (enable only if you add /api/research)
const API_WRITER = "/research";
document.getElementById('runWriter')?.addEventListener('click', async ()=>{
  const payload = {
    query: document.getElementById('topic').value.trim(),
    tone: document.getElementById('tone').value,
    audience: document.getElementById('audience').value,
    target_lang: "en"
  };
  if(!payload.query) return;
  const r = await fetch(API_WRITER,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
  const j = await r.json();
  document.getElementById('writerText').textContent = j.report || "No draft.";
  document.getElementById('writerOut').style.display = "block";
});
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Promptly Resumed — Research Lab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#0f1011" />
  <meta name="description" content="SQL + Python + lightweight AI summaries. Gated research portal with xAI and Streamlit." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    body{font-family:Inter,system-ui,-apple-system,sans-serif;background:#fff;color:#111827;margin:0;line-height:1.55}
    header{padding:20px;border-bottom:1px solid #e5e7eb;text-align:center}
    h1{font-size:28px;margin:0;font-weight:600}
    .grid{display:grid;grid-template-columns:280px 1fr;gap:16px;padding:20px;max-width:1200px;margin:auto}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
    .panel{border:1px solid #e5e7eb;border-radius:10px;padding:16px}
    input{width:100%;padding:14px;border:1px solid #d1d5db;border-radius:8px;font-size:16px}
    .row{margin-top:10px;display:flex;gap:10px}
    .btn{border:1px solid #e5e7eb;border-radius:8px;padding:10px 14px;text-decoration:none;color:#111}
    .btn:hover{background:#111;color:#fff;border-color:#111}
    iframe{width:100%;height:560px;border:1px solid #e5e7eb;border-radius:10px}
    footer{text-align:center;padding:20px;color:#6b7280;font-size:14px;border-top:1px solid #e5e7eb;margin-top:20px}
    .gate{position:fixed;inset:0;background:#0b1220;color:#e5e7eb;display:flex;align-items:center;justify-content:center;z-index:9999}
    .gate-inner{background:#0f172a;padding:20px;border-radius:12px;width:90%;max-width:360px}
    .gate h2{margin:0 0 6px;font-weight:600}
    .gate input{width:100%;padding:10px;border-radius:8px;border:1px solid #334155;background:#0b1020;color:#e5e7eb}
    .gate .btn{display:inline-block;margin-top:12px;border:1px solid #334155;border-radius:8px;padding:8px 12px;color:#e5e7eb;text-decoration:none}
    .gate .btn:hover{background:#e5e7eb;color:#0b1220}
  </style>
</head>
<body>
  <div class="gate" id="gate">
    <div class="gate-inner">
      <h2>Access Required</h2>
      <p>Enter the site password to continue</p>
      <input id="pw" type="password" placeholder="Password" />
      <a id="unlockBtn" class="btn" href="#">Unlock</a>
      <p id="gateError" style="color:#fca5a5;display:none;margin-top:8px">Incorrect password</p>
    </div>
  </div>

  <header><h1>Promptly Resumed — Research Lab</h1></header>
  <div class="grid" id="main" style="display:none">
    <aside class="panel">
      <h3>Research Prompt</h3>
      <input id="q" type="text" placeholder="e.g. Semiconductor export controls" />
      <div class="row">
        <a id="openApp" class="btn" href="#" rel="noopener">Open in App</a>
        <a id="copyLink" class="btn" href="#" rel="noopener">Copy link</a>
      </div>
    </aside>

    <section class="panel">
      <iframe id="appFrame" title="Streamlit App"></iframe>
      <div id="resultsBox" style="margin-top:10px;color:#6b7280">Results will appear here…</div>
    </section>
  </div>

  <footer>© promptlyresumed.com</footer>

  <script>
    const PAGE_PASSWORD = "logic1337";
    const APP_BASE = "https://spazedd-dataanalysis-app-pqclrv.streamlit.app";

    // Password gate
    const gate=document.getElementById("gate");
    const main=document.getElementById("main");
    const pw=document.getElementById("pw");
    const unlock=document.getElementById("unlockBtn");
    const err=document.getElementById("gateError");
    function unlockSite(val){
      if(val===PAGE_PASSWORD){
        gate.style.display="none"; main.style.display="";
        localStorage.setItem("pr_gate","ok");
      }else{err.style.display="block";}
    }
    try{if(localStorage.getItem("pr_gate")==="ok"){gate.style.display="none";main.style.display="";}}catch{}
    unlock.addEventListener("click",e=>{e.preventDefault();unlockSite(pw.value);});
    pw.addEventListener("keydown",e=>{if(e.key==="Enter")unlockSite(pw.value);});

    // App linking
    const q=document.getElementById("q");
    const openApp=document.getElementById("openApp");
    const copyLink=document.getElementById("copyLink");
    const frame=document.getElementById("appFrame");
    function updateLinks(){
      const topic=encodeURIComponent((q.value||"").trim());
      const href=topic?`${APP_BASE}/?q=${topic}&origin=${encodeURIComponent(location.origin)}`:`${APP_BASE}/?origin=${encodeURIComponent(location.origin)}`;
      openApp.href=href;openApp.target="_blank";
      copyLink.onclick=(e)=>{e.preventDefault();navigator.clipboard.writeText(href);copyLink.textContent="Copied";setTimeout(()=>copyLink.textContent="Copy link",1000);};
      frame.src=href+(href.includes("?")?"&":"?")+"embed=1";
    }
    q.addEventListener("input",updateLinks);updateLinks();

    // Receive results
    const resultsBox=document.getElementById("resultsBox");
    window.addEventListener("message",event=>{
      try{
        const appOrigin=new URL(APP_BASE).origin;
        if(event.origin!==appOrigin)return;
      }catch{return;}
      const data=event.data||{};
      if(data.type!=="pr_results"||!data.payload)return;
      const p=data.payload;
      let html="";
      if(p.topic)html+=`<h3>${p.topic}</h3>`;
      if(p.summary)html+=`<p>${p.summary}</p>`;
      if(Array.isArray(p.results)&&p.results.length){
        html+="<ul>";
        for(const r of p.results.slice(0,6)){
          const t=r.title||r.url||"";const u=r.url?`<a href='${r.url}' target='_blank'>${t}</a>`:t;
          html+=`<li>${u} — ${r.domain||""}</li>`;
        }
        html+="</ul>";
      }
      resultsBox.innerHTML=html||"No results.";
    });
  </script>
</body>
</html>